{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
{% include 'navbar.html' %}
<h1 class="m-3">Hello Admin</h1>
<section>
    <hr class="border">
    <h2 class="m-3">Services</h2>
    <table class="table table-bordered table-primary align-middle">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Price</th>
                <th>Time Required</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody class="table-group-divider">
            {% for service in services %}
            <tr>
                <td>{{ service.id }}</td>
                <td>{{ service.name }}</td>
                <td>{{ service.price }}</td>
                <td>{{ service.time_required }} mins</td>
                <td>
                    <form action="{{ url_for('edit_service', service_id=service.id) }}" method="post"
                        style="display:inline;">
                        <button type="submit" class="btn btn-warning mx-2 px-3">Edit</button>
                    </form>
                    <form action="{{ url_for('delete_service', service_id=service.id) }}" method="post"
                        style="display:inline;"
                        onsubmit="return confirm('Are you sure you want to delete this service?');">
                        <button type="submit" class="btn btn-danger mx-2 px-2">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <a href="{{ url_for('add_service') }}" class="btn btn-light"> + Add New Service </a>
</section>

<section>
    <hr class="border">
    <h2 class="m-3">Professionals</h2>
    <table class="table table-bordered table-primary align-middle">
        <thead>
            <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Status</th>
                <th>Rating</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody class="table-group-divider">
            {% for user in users %}
            <tr>
                <td><a href="{{ url_for('view_user_details', user_id=user.id) }}" class="btn btn-link btn-lg">{{ user.id
                        }}</a>
                </td>
                <td>{{ user.username }}</td>
                <td>{{ user.status }}</td>
                <td>{{ average_ratings_dict.get(user.id, 'N/A') }} out of 5</td>
                <td>
                    {% if user.status == 'pending' %}
                    <form action="{{ url_for('approve_user', user_id=user.id) }}" method="POST" style="display:inline;"
                        onsubmit="return confirm('Are you sure you want to approve this user?');">
                        <button type="submit" class="btn btn-success mx-2 px-2">Approve</button>
                    </form>
                    <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST" style="display:inline;"
                        onsubmit="return confirm('Are you sure you want to delete this user?');">
                        <button type="submit" class="btn btn-danger mx-2 px-2">Delete</button>
                    </form>
                    {% elif user.status != 'blocked' %}
                    <form action="{{ url_for('block_user', user_id=user.id) }}" method="POST" style="display:inline;"
                        onsubmit="return confirm('Are you sure you want to block this user?');">
                        <button type="submit" class="btn btn-warning mx-2 px-2">Block</button>
                    </form>
                    <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST" style="display:inline;"
                        onsubmit="return confirm('Are you sure you want to delete this user?');">
                        <button type="submit" class="btn btn-danger mx-2 px-2">Delete</button>
                    </form>
                    {% else %}
                    <span class="text-muted">Blocked</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

<section>
    <hr class="border">
    <h2 class="m-3">Service Requests</h2>
    <table class="table table-bordered table-primary align-middle">
        <thead>
            <tr>
                <th>ID</th>
                <th>Assigned Professional</th>
                <th>Date of Request</th>
                <th>Date of Completion</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody class="table-group-divider">
            {% for request in requests %}
            <tr>
                <td>{{ request.id }}</td>
                <td>{{ request.professional_name }}</td>
                <td>{{ request.time_of_request.strftime('%d-%m-%Y %H:%M') }}</td>
                <td>
                    {% if request.time_of_completion %}
                    {{ request.time_of_completion.strftime('%d-%m-%Y %H:%M') }}
                    {% else %}
                    NA
                    {% endif %}
                </td>
                <td>{{ request.task }}</td>
                <td>{{ request.service_status }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>
{% endblock %}